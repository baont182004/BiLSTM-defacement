<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ app_name }} - Deface Watcher</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>DW</text></svg>"
    />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">Deface Watcher</p>
          <h1>{{ app_name }}</h1>
          <p class="subtitle">
            Kiểm tra nhanh dấu hiệu deface với BiLSTM + Puppeteer. Theo dõi thời gian cào và dự đoán trong một bảng điều
            khiển gọn gàng.
          </p>
        </div>
        <div class="hero-card">
          <div class="hero-stat">
            <span>MAX_LENGTH</span>
            <strong>128</strong>
          </div>
          <div class="hero-stat">
            <span>Pipeline</span>
            <strong>Puppeteer → Requests</strong>
          </div>
          <div class="hero-stat">
            <span>Model</span>
            <strong>BiLSTM</strong>
          </div>
        </div>
      </header>

      <section class="panel">
        <div class="panel-header">
          <h2>Kiểm tra URL</h2>
          <p>Nhập URL và theo dõi tiến trình trích xuất nội dung ngay bên dưới.</p>
        </div>
        <form id="predict-form" class="predict-form">
          <input type="url" id="url-input" placeholder="https://example.com" required />
          <button type="submit" id="predict-button">
            <span class="button-label">Kiểm tra</span>
            <span class="button-icon">→</span>
          </button>
        </form>
        <div id="progress" class="progress hidden">
          <div class="spinner"></div>
          <div>
            <p id="progress-title">Đang xử lý</p>
            <p id="progress-detail">Chuẩn bị cào dữ liệu...</p>
          </div>
        </div>
        <div id="error-message" class="error hidden"></div>
      </section>

      <section id="result-container" class="panel result hidden">
        <div class="result-header">
          <div>
            <h2>Kết quả phân tích</h2>
            <p id="result-url" class="result-url"></p>
          </div>
          <div id="result-badge" class="badge">--</div>
        </div>
        <div class="result-grid">
          <div class="result-card">
            <h3>Chẩn đoán</h3>
            <p class="result-status" id="result-status">--</p>
            <p class="result-prob">
              Xác suất Deface: <span id="result-prob">--</span>
            </p>
            <div class="result-meta">
              <div>
                <span>Nguồn trích xuất</span>
                <strong id="result-source">--</strong>
              </div>
              <div>
                <span>Thời gian cào</span>
                <strong><span id="scrape-time">--</span> ms</strong>
              </div>
              <div>
                <span>Thời gian dự đoán</span>
                <strong><span id="predict-time">--</span> ms</strong>
              </div>
              <div>
                <span>Tổng thời gian</span>
                <strong><span id="total-time">--</span> ms</strong>
              </div>
            </div>
            <div id="source-warning" class="warning hidden">
              Đang dùng fallback Requests. Kết quả có thể thiếu nội dung động.
            </div>
          </div>
          <div class="result-card">
            <h3>Tiến trình</h3>
            <div class="timeline">
              <div class="timeline-step" id="step-scrape">
                <span>1</span>
                <div>
                  <strong>Cào nội dung</strong>
                  <p id="step-scrape-detail">--</p>
                </div>
              </div>
              <div class="timeline-step" id="step-predict">
                <span>2</span>
                <div>
                  <strong>Dự đoán BiLSTM</strong>
                  <p id="step-predict-detail">--</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <details class="accordion">
          <summary>Xem văn bản trích xuất</summary>
          <div class="accordion-toolbar">
            <div class="toolbar-group">
              <button type="button" id="text-copy">Sao chép</button>
              <button type="button" id="text-download">Tải .txt</button>
              <button type="button" id="text-fullscreen">Toàn màn hình</button>
            </div>
            <div class="toolbar-group toolbar-search">
              <input type="text" id="text-search" placeholder="Tìm trong văn bản..." />
              <button type="button" id="text-prev">Trước</button>
              <button type="button" id="text-next">Sau</button>
              <span id="text-match-count">0/0</span>
              <button type="button" id="text-top">Lên đầu</button>
            </div>
            <label class="toolbar-toggle">
              <input type="checkbox" id="text-show-full" />
              <span>Hiện toàn bộ</span>
            </label>
          </div>
          <p class="accordion-meta" id="text-meta"></p>
          <div class="text-viewer">
            <div id="result-text" class="text-pre"></div>
          </div>
        </details>

        <details class="accordion">
          <summary>Xem tokenized preview</summary>
          <div class="accordion-toolbar">
            <div class="toolbar-group">
              <button type="button" id="token-copy">Sao chép</button>
              <button type="button" id="token-download">Tải .json</button>
              <button type="button" id="token-toggle-view">Xem JSON</button>
            </div>
          </div>
          <div id="token-stats" class="token-stats hidden"></div>
          <div id="token-grid" class="token-grid hidden"></div>
          <pre id="token-preview">--</pre>
        </details>
      </section>

      <div id="text-modal" class="text-modal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="text-modal__overlay" id="text-modal-overlay"></div>
        <div class="text-modal__panel">
          <header class="text-modal__header">
            <h3>Văn bản trích xuất</h3>
            <div class="text-modal__actions">
              <input type="text" id="text-search-modal" placeholder="Tìm trong văn bản..." />
              <button type="button" id="text-copy-modal">Sao chép</button>
              <button type="button" id="text-download-modal">Tải .txt</button>
              <button type="button" id="text-close-modal">Đóng</button>
            </div>
          </header>
          <div class="text-modal__content">
            <div id="text-modal-body" class="text-pre"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
